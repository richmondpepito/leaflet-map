<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dynamic Route Map</title>
  <style>
    #map {
      height: 600px;
      width: 100%;
    }
  </style>
  <script>
    // Your Google Maps API key
    const API_KEY = 'AIzaSyDuRPAa1M6SNEvcFqy0tLCjl3eZ0Go-9m0';  // Replace with your actual API key

    let map;

    // Initialize the map
    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 10.3157, lng: 123.8854 }, // Default to Cebu
        zoom: 6,
      });

      // Fetch data from Google Sheets every minute
      setInterval(fetchDataFromGoogleSheet, 60000); // Refresh every 60 seconds
    }

    // Fetch data from Google Sheets using API
    function fetchDataFromGoogleSheet() {
      const sheetId = '1nluU05qQODaIe6-WP4hawC10awP94xwlO2hfspxBDy0'; // Your Google Sheet ID
      const apiKey = 'AIzaSyDuRPAa1M6SNEvcFqy0tLCjl3eZ0Go-9m0';  // Your API Key
      const sheetURL = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/Sheet1?key=${apiKey}`;

      fetch(sheetURL)
        .then(response => response.json())
        .then(data => {
          // Process the data and update the map
          const rows = data.values;
          const routesData = rows.slice(1).map(row => ({
            routeID: row[0],
            originLat: parseFloat(row[1]),
            originLong: parseFloat(row[2]),
            destinationLat: parseFloat(row[3]),
            destinationLong: parseFloat(row[4]),
            routeType: row[5],
            supervisor: row[6],
            warehouseType: row[7],
          }));

          // Call the update map function with the newly fetched data
          updateMap('all', 'all', routesData);  // Update the map with new data
        })
        .catch(error => console.error('Error fetching data:', error));
    }

    // Update the map with new data
    function updateMap(supervisorFilter, warehouseFilter, routesData) {
      // Clear any previous markers or routes
      clearMapMarkersAndRoutes();

      routesData.forEach(route => {
        // Apply filters based on Supervisor and Warehouse Type if necessary
        if (
          (supervisorFilter === 'all' || route.supervisor === supervisorFilter) &&
          (warehouseFilter === 'all' || route.warehouseType === warehouseFilter)
        ) {
          // Create markers for the origin and destination locations
          createMarker(map, route.originLat, route.originLong, 'Origin');
          createMarker(map, route.destinationLat, route.destinationLong, 'Destination');

          // Draw a line connecting the origin and destination
          drawLine(map, route.originLat, route.originLong, route.destinationLat, route.destinationLong, route.routeType);
        }
      });
    }

    // Helper function to create markers
    function createMarker(map, lat, lng, label) {
      new google.maps.Marker({
        position: { lat, lng },
        map: map,
        label: label,
      });
    }

    // Helper function to draw routes between origin and destination
    function drawLine(map, originLat, originLong, destinationLat, destinationLong, routeType) {
      let strokeColor;
      switch (routeType) {
        case 'Cebu Main to Sub-warehouse':
          strokeColor = 'black';
          break;
        case 'Cebu Main to Bin':
          strokeColor = 'black';
          break;
        case 'Sub-warehouse to Satellite Warehouse':
          strokeColor = 'blue';
          break;
        case 'Sub-warehouse to Bin':
          strokeColor = 'blue';
          break;
        case 'Satellite Warehouse to Bin':
          strokeColor = 'green';
          break;
        default:
          strokeColor = 'gray';
      }

      const line = new google.maps.Polyline({
        path: [
          { lat: originLat, lng: originLong },
          { lat: destinationLat, lng: destinationLong },
        ],
        geodesic: true,
        strokeColor: strokeColor,
        strokeOpacity: 1.0,
        strokeWeight: 4,
      });
      line.setMap(map);
    }

    // Function to clear any existing markers and lines from the map
    function clearMapMarkersAndRoutes() {
      // Clear previous markers and lines
      // You will need to store the markers and lines in an array to remove them when needed
    }

  </script>
</head>
<body onload="initMap()">
  <h1>Route Map</h1>
  <div id="map"></div>

  <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_API_KEY&callback=initMap"></script>
</body>
</html>
