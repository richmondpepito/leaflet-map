<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Warehouse Routes Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <style>
    #map { height: 600px; width: 100%; }
    #filters { margin: 20px; font-family: Arial, sans-serif; }
    #resetButton { padding: 6px 12px; margin-left:10px; }
    .legend { background:white; padding:8px; font-size:12px; line-height:1.4; border-radius:4px; border:1px solid #ccc; }
    .legend span { display:inline-block; width:12px; height:12px; margin-right:4px; vertical-align:middle; }
  </style>
</head>
<body>
  <div id="filters">
    <label>Warehouse Type: <select id="warehouseTypeFilter"></select></label>
    <label>Supervisor: <select id="supervisorFilter"></select></label>
    <label>Region: <select id="regionFilter"></select></label>
    <label>Province: <select id="provinceFilter"></select></label>
    <button id="resetButton">Reset View</button>
  </div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script>
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR0YzBM0KMyrNOC9sZ0KiLDwlk4kgVmjSxpls4k_aD-Wg9fbK2WYHUTstuI6XDqWSvHuy3gXtIz3l6g/pub?gid=542207452&single=true&output=csv';

    const map = L.map('map').setView([12.8797, 121.7740], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    const cebuIcon = L.icon({ iconUrl: 'https://www.gtcosmetics.com.ph/wp-content/uploads/2020/10/GT-Cosmetics.png', iconSize:[32,32], iconAnchor:[16,32], popupAnchor:[0,-32] });

    const regionBounds = {
      "all": [[4.5,116],[20.5,127]],
      "Region I": [[15.6,119.5],[18.7,121.5]], "CAR": [[16,120.5],[18,122]], "Region II": [[16.2,121.3],[18.5,122.5]],
      "Region III": [[14.5,119.5],[16.2,121.5]], "NCR": [[14.3,120.8],[14.8,121.2]], "Region IV-A": [[13.4,120.5],[15,122]],
      "Region IV-B": [[11.8,118],[13.8,121.5]], "Region V": [[12.5,123.2],[14,124.5]], "Region VI": [[10.3,121],[11.8,123]],
      "Region VII": [[9.2,122.2],[11.5,124]], "Region VIII": [[10.5,124.5],[12.5,126]], "Region IX": [[6,121],[8.5,123]],
      "Region X": [[7.5,123.5],[9.5,125]], "Region XI": [[6.5,125],[8,126.5]], "Region XII": [[6,124],[7.8,126]],
      "Region XIII": [[8.5,125],[10.5,126.5]], "BARMM": [[5.5,120],[7.8,124.5]]
    };

    const provinceBounds = {
      "Ilocos Norte": [[17.8, 120.4], [18.6, 121.0]],
      "Ilocos Sur": [[17.0, 120.3], [17.8, 120.9]],
      "La Union": [[16.2, 120.1], [16.8, 120.6]],
      "Pangasinan": [[15.5, 119.7], [16.3, 120.9]],
      "Abra": [[17.3, 120.5], [17.9, 121.0]],
      "Apayao": [[18.0, 121.0], [18.5, 121.5]],
      "Benguet": [[16.2, 120.4], [16.8, 121.0]],
      "Ifugao": [[16.6, 120.9], [17.0, 121.3]],
      "Kalinga": [[17.2, 121.0], [17.8, 121.5]],
      "Mountain Province": [[16.8, 120.8], [17.2, 121.3]],
      "Cagayan": [[17.7, 121.3], [18.5, 122.3]],
      "Isabela": [[16.7, 121.3], [17.7, 122.0]],
      "Nueva Vizcaya": [[16.2, 120.9], [16.7, 121.3]],
      "Quirino": [[16.1, 121.3], [16.5, 121.7]],
      "Aurora": [[15.6, 121.3], [16.1, 122.0]],
      "Bataan": [[14.4, 120.3], [14.8, 120.6]],
      "Bulacan": [[14.8, 120.8], [15.2, 121.3]],
      "Nueva Ecija": [[15.2, 120.8], [15.8, 121.3]],
      "Pampanga": [[15.0, 120.5], [15.4, 121.0]],
      "Tarlac": [[15.3, 120.3], [15.7, 121.0]],
      "Zambales": [[14.7, 119.9], [15.8, 120.3]],
      "Metro Manila": [[14.4, 120.9], [14.8, 121.2]],
      "Batangas": [[13.5, 120.5], [14.2, 121.2]],
      "Cavite": [[14.2, 120.8], [14.5, 121.1]],
      "Laguna": [[14.1, 121.1], [14.5, 121.6]],
      "Quezon": [[13.2, 121.2], [14.1, 122.1]],
      "Rizal": [[14.4, 121.0], [14.8, 121.4]],
      "Marinduque": [[13.2, 121.8], [13.6, 122.2]],
      "Occidental Mindoro": [[12.2, 120.5], [13.4, 121.5]],
      "Oriental Mindoro": [[12.4, 121.0], [13.6, 122.2]],
      "Palawan": [[8.8, 117.5], [11.2, 120.4]],
      "Romblon": [[12.3, 122.0], [12.8, 122.5]],
      "Albay": [[13.0, 123.4], [13.5, 124.0]],
      "Camarines Norte": [[14.0, 122.5], [14.3, 123.0]],
      "Camarines Sur": [[13.2, 122.5], [13.8, 123.7]],
      "Catanduanes": [[13.5, 124.0], [14.0, 124.5]],
      "Masbate": [[12.0, 123.0], [12.7, 124.0]],
      "Sorsogon": [[12.4, 123.7], [13.1, 124.2]],
      "Antique": [[10.5, 121.6], [11.3, 122.3]],
      "Capiz": [[11.2, 122.5], [11.7, 123.0]],
      "Iloilo": [[10.6, 122.1], [11.3, 123.1]],
      "Negros Occidental": [[9.7, 122.0], [11.1, 123.5]],
      "Bohol": [[9.5, 124.0], [10.1, 124.6]],
      "Cebu": [[9.8, 123.3], [11.3, 124.1]],
      "Negros Oriental": [[9.0, 122.7], [9.9, 124.2]],
      "Siquijor": [[9.1, 123.4], [9.3, 123.7]],
      "Biliran": [[11.5, 124.3], [11.7, 124.7]],
      "Eastern Samar": [[11.1, 125.0], [12.0, 125.8]],
      "Leyte": [[10.7, 124.5], [11.5, 125.5]],
      "Northern Samar": [[12.3, 124.1], [12.7, 125.2]],
      "Samar": [[11.5, 124.7], [12.2, 125.3]],
      "Southern Leyte": [[9.9, 124.8], [10.5, 125.3]],
      "Zamboanga del Norte": [[8.0, 122.2], [8.9, 123.5]],
      "Zamboanga del Sur": [[7.4, 123.0], [8.2, 123.6]],
      "Zamboanga Sibugay": [[7.2, 122.5], [7.9, 123.1]],
      "Bukidnon": [[7.7, 124.7], [8.7, 125.5]],
      "Camiguin": [[9.1, 124.5], [9.3, 124.7]],
      "Lanao del Norte": [[7.8, 124.0], [8.4, 124.9]],
      "Misamis Occidental": [[8.1, 123.5], [8.6, 124.0]],
      "Misamis Oriental": [[8.3, 124.3], [9.0, 125.0]],
      "Compostela Valley": [[7.4, 126.0], [8.0, 126.5]],
      "Davao del Norte": [[7.0, 125.4], [7.8, 126.2]],
      "Davao del Sur": [[6.5, 125.0], [7.4, 125.6]],
      "Davao Oriental": [[6.5, 126.0], [7.5, 127.0]],
      "Cotabato": [[6.8, 124.0], [7.5, 125.0]],
      "South Cotabato": [[6.0, 124.8], [6.8, 125.5]],
      "Sultan Kudarat": [[6.3, 124.2], [6.9, 125.1]],
      "Sarangani": [[5.5, 125.0], [6.3, 125.6]],
      "Agusan del Norte": [[8.9, 125.2], [9.3, 125.8]],
      "Agusan del Sur": [[8.0, 125.7], [8.8, 126.5]],
      "Dinagat Islands": [[10.0, 125.3], [10.3, 125.7]],
      "Surigao del Norte": [[9.7, 125.3], [10.1, 126.0]],
      "Surigao del Sur": [[8.5, 125.7], [9.6, 126.3]],
      "Basilan": [[6.4, 121.2], [6.7, 122.2]],
      "Lanao del Sur": [[7.3, 123.6], [8.2, 124.6]],
      "Maguindanao": [[6.8, 124.0], [7.5, 124.8]],
      "Sulu": [[5.9, 120.8], [6.3, 121.4]],
      "Tawi-Tawi": [[5.0, 119.5], [5.8, 120.3]]
    };

    let allData = [], lines = [], markers = [], currentRegion = 'all', currentProvince = 'all';

    Papa.parse(sheetUrl, {
      download: true,
      header: true,
      complete: res => {
        allData = res.data.filter(r => r['Route ID']);
        setup();
      }
    });

    function setup() {
      populateFilters();
      updateMap();
      addLegend();
    }

    function populateFilters(){
      const w=new Set(), s=new Set(), r=new Set(), pm={};
      allData.forEach(d=>{
        w.add(d['Warehouse Type']); s.add(d['Supervisor']); r.add(d['Regional Destination']);
        const reg=d['Regional Destination'], prov=d['Provincial Destination'];
        if(reg&&prov){ pm[reg]=pm[reg]||new Set(); pm[reg].add(prov);} });

      const wf=document.getElementById('warehouseTypeFilter'), sf=document.getElementById('supervisorFilter');
      const rf=document.getElementById('regionFilter'), pf=document.getElementById('provinceFilter');

      wf.innerHTML='<option value="all">All</option>'+[...w].map(i=>`<option>${i}</option>`).join('');
      sf.innerHTML='<option value="all">All</option>'+[...s].map(i=>`<option>${i}</option>`).join('');
      rf.innerHTML='<option value="all">All</option>'+[...r].map(i=>`<option>${i}</option>`).join('');

      rf.onchange=()=>{
        currentRegion = rf.value;
        pf.innerHTML='<option value="all">All</option>'+[...(pm[rf.value]||[])].map(i=>`<option>${i}</option>`).join('');
        zoomToRegion(rf.value);
        updateMap();
      };
      pf.onchange=()=>{
        currentProvince = pf.value;
        zoomToProvince(currentProvince);
        updateMap();
      }

      ['warehouseTypeFilter','supervisorFilter'].forEach(id=>document.getElementById(id).onchange=updateMap);
      document.getElementById('resetButton').onclick=resetView;
    }

    function updateMap(){
      lines.forEach(l=>map.removeLayer(l)); lines=[];
      markers.forEach(m=>map.removeLayer(m)); markers=[];
      const wf=document.getElementById('warehouseTypeFilter').value,
            sf=document.getElementById('supervisorFilter').value;

      const filt = allData.filter(d=>
        (wf==='all'||d['Warehouse Type']===wf)&&
        (sf==='all'||d['Supervisor']===sf)&&
        (currentRegion==='all'||d['Regional Destination']===currentRegion)&&
        (currentProvince==='all'||d['Provincial Destination']===currentProvince)
      );

      filt.forEach(draw);
    }

    function draw(d){
      const oLat = +d['Origin Lat'], oLng = +d['Origin Long'];
      const dLat = +d['Destination Lat'], dLng = +d['Destination Long'];
      if (isNaN(oLat) || isNaN(oLng) || isNaN(dLat) || isNaN(dLng)) return;

      const o=[oLat, oLng], u=[dLat, dLng];
      const txt=`Route Type: ${d['Route Type']}<br>From: ${d['Origin Name']}<br>To: ${d['Destination Name']}<br>Location: ${d['Destination Location']}<br>Supervisor: ${d['Supervisor']}`;
      const line=L.polyline([o,u],{color:getColor(d['Route Type']),weight:1.5,dashArray:getDash(d['Route Type'])}).addTo(map).bindTooltip(txt);
      lines.push(line);
      let om;
      if(Math.abs(o[0]-10.3801)<0.01&&Math.abs(o[1]-123.9959)<0.01){
        om=L.marker(o,{icon:cebuIcon}).bindTooltip('GTCosmetics Manufacturing Inc.<br>Main Plant<br>Tayud, Liloan, Cebu');
      } else {
        om=L.circleMarker(o,{radius:getSize(d['Route Type']),color:getColor(d['Route Type'])}).bindTooltip(txt);
      }
      const dm=L.circleMarker(u,{radius:getSize(d['Route Type']),color:getColor(d['Route Type'])}).bindTooltip(txt);
      map.addLayer(om); map.addLayer(dm);
      markers.push(om,dm);
    }

    function getColor(t){ if(t.startsWith('Cebu Main'))return'black'; if(t.includes('Satellite'))return'green'; if(t.includes('Sub-warehouse'))return'blue'; return'gray'; }
    function getDash(t){ return t.includes('to Bin')?'5,5':null; }
    function getSize(t){ return {'CebuProvincial Destination']===currentProvince));

      filt.forEach(d=>{
        const latlngs=[[+d['Latitude'],+d['Longitude']],[+d['Destination Latitude'],+d['Destination Longitude']]];
        const color=getColor(d['Warehouse Type']);
        const line=L.polyline(latlngs,{color}).addTo(map).bindTooltip(d['Route ID']);
        const marker=L.marker(latlngs[0],{icon:cebuIcon}).bindPopup(d['Warehouse Name']).addTo(map);

        lines.push(line); markers.push(marker);
      });
    }

    function resetView(){ map.fitBounds(regionBounds['all']); currentRegion='all'; currentProvince='all'; }

    function zoomToRegion(region){
      if(regionBounds[region]) map.fitBounds(regionBounds[region]);
    }

    function zoomToProvince(prov){
      if(provinceBounds[prov]) map.fitBounds(provinceBounds[prov]);
    }

    function getColor(type){
      const c={
        'Cebu Main':'#1f77b4','Sub-warehouse':'#ff7f0e','Satellite Warehouse':'#2ca02c','Bin':'#d62728'
      }; return c[type]||'#888';
    }

    function addLegend(){
      const div = L.DomUtil.create('div', 'legend');
      div.innerHTML = '<b>Warehouse Type</b><br>' +
        '<span style="background:#1f77b4"></span> Cebu Main<br>' +
        '<span style="background:#ff7f0e"></span> Sub-warehouse<br>' +
        '<span style="background:#2ca02c"></span> Satellite Warehouse<br>' +
        '<span style="background:#d62728"></span> Bin';
      L.control({ position: 'bottomright', content: div }).onAdd = () => div;
      L.control({ position: 'bottomright' }).addTo(map);
    }
  </script>
</body>
</html>
